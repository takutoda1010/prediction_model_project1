"0",""
"0","# 2. ãƒ¢ãƒ‡ãƒ«äºˆæ¸¬ã®è©³ç´°åˆ†æ"
"0","message(""\nğŸ“Š 2. Model Prediction Analysis by Dataset"")"
"2","
ğŸ“Š 2. Model Prediction Analysis by Dataset
"
"0","message(paste(rep(""-"", 50), collapse = """"))"
"2","--------------------------------------------------
"
"0","if (exists(""best_model"")) {"
"0","  for (set_name in c(""train"", ""val"", ""test"")) {"
"0","    data <- split_data_fixed[[set_name]]"
"0","    "
"0","    # ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢è¨ˆç®—"
"0","    risk_scores <- predict(best_model, newdata = data, type = ""risk"")"
"0","    "
"0","    # å››åˆ†ä½ã§åˆ†å‰²"
"0","    risk_quartiles <- cut(risk_scores, "
"0","                          quantile(risk_scores, probs = c(0, 0.25, 0.5, 0.75, 1)),"
"0","                          labels = c(""Q1(Low)"", ""Q2"", ""Q3"", ""Q4(High)""),"
"0","                          include.lowest = TRUE)"
"0","    "
"0","    # å„å››åˆ†ä½ã®å†ç™ºç‡"
"0","    message(sprintf(""\n%s Set Risk Stratification:"", set_name))"
"0","    for (q in levels(risk_quartiles)) {"
"0","      q_data <- data[risk_quartiles == q, ]"
"0","      recur_rate <- mean(q_data$recur_2y == TRUE, na.rm = TRUE) * 100"
"0","      n_patients <- sum(risk_quartiles == q, na.rm = TRUE)"
"0","      message(sprintf(""  %s: %.1f%% (n=%d)"", q, recur_rate, n_patients))"
"0","    }"
"0","  }"
"0","}"
"2","
train Set Risk Stratification:
"
"2","  Q1(Low): 24.6% (n=142)
"
"2","  Q2: 43.0% (n=142)
"
"2","  Q3: 58.9% (n=141)
"
"2","  Q4(High): 69.7% (n=142)
"
"2","
val Set Risk Stratification:
"
"2","  Q1(Low): 12.5% (n=48)
"
"2","  Q2: 29.8% (n=47)
"
"2","  Q3: 44.7% (n=47)
"
"2","  Q4(High): 55.3% (n=47)
"
"2","
test Set Risk Stratification:
"
"2","  Q1(Low): 8.3% (n=48)
"
"2","  Q2: 19.1% (n=47)
"
"2","  Q3: 46.8% (n=47)
"
"2","  Q4(High): 61.7% (n=47)
"
"0","# 3. å¹´åº¦åˆ¥ã®å†ç™ºç‡ãƒˆãƒ¬ãƒ³ãƒ‰ï¼ˆä¿®æ­£ç‰ˆï¼šdplyrã‚’ä½¿ã‚ãªã„ï¼‰"
"0","message(""\nğŸ“Š 3. Yearly Recurrence Rate Trends"")"
"2","
ğŸ“Š 3. Yearly Recurrence Rate Trends
"
"0","message(paste(rep(""-"", 50), collapse = """"))"
"2","--------------------------------------------------
"
"0","# å¹´åº¦åˆ¥é›†è¨ˆ"
"0","yearly_data <- final_data"
"0","yearly_data$op_year <- as.numeric(format(yearly_data$op_date, ""%Y""))"
"0","yearly_data$recur_2y_calc <- (yearly_data$recur_tf == TRUE & "
"0","                              yearly_data$rfs_months <= 24)"
"0",""
"0","# 2000-2021å¹´ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿"
"0","yearly_data <- yearly_data[yearly_data$op_year >= 2000 & "
"0","                          yearly_data$op_year <= 2021, ]"
"0",""
"0","yearly_trends <- aggregate("
"0","  recur_2y_calc ~ op_year,"
"0","  data = yearly_data,"
"0","  FUN = function(x) c(N = length(x), Rate = mean(x, na.rm = TRUE) * 100)"
"0",")"
"0",""
"0","print(yearly_trends)"
