"0","# ========================================"
"0","# ãƒªã‚¹ã‚¯ç¾¤åˆ¥ã®ç”Ÿå­˜æ›²ç·šåˆ†æ"
"0","# ========================================"
"0",""
"0","library(survival)"
"0","library(survminer)"
"0","library(cmprsk)  # ç«¶åˆãƒªã‚¹ã‚¯åˆ†æç”¨"
"0",""
"0","message(""\nğŸ“Š Risk-Stratified Survival Analysis"")"
"2","
ğŸ“Š Risk-Stratified Survival Analysis
"
"0","message(paste(rep(""="", 50), collapse = """"))"
"2","==================================================
"
"0","# 1. ãƒªã‚¹ã‚¯ç¾¤ã®ä½œæˆ"
"0","create_risk_groups <- function(model, data, cutoffs = c(1/3, 2/3)) {"
"0","  # ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢è¨ˆç®—"
"0","  risk_scores <- predict(model, newdata = data, type = ""risk"")"
"0","  "
"0","  # ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«ã§ã‚«ãƒƒãƒˆ"
"0","  cuts <- quantile(risk_scores, probs = c(0, cutoffs, 1))"
"0","  "
"0","  # ãƒªã‚¹ã‚¯ç¾¤ä½œæˆ"
"0","  risk_groups <- cut(risk_scores,"
"0","                    breaks = cuts,"
"0","                    labels = c(""Low"", ""Medium"", ""High""),"
"0","                    include.lowest = TRUE)"
"0","  "
"0","  return(risk_groups)"
"0","}"
"0",""
"0","# 2. Test setã§ãƒªã‚¹ã‚¯ç¾¤ä½œæˆ"
"0","test_data <- split_data_fixed$test"
"0","test_data$risk_group <- create_risk_groups(best_model, test_data)"
"0",""
"0","# ãƒªã‚¹ã‚¯ç¾¤åˆ¥ã®å†ç™ºç‡"
"0","message(""\nRisk group distribution:"")"
"2","
Risk group distribution:
"
"0","risk_table <- table(test_data$risk_group, test_data$recur_2y)"
"0","print(prop.table(risk_table, margin = 1))"
"1","        
"
"1","        "
"1","   FALSE"
"1","    TRUE"
"1","
  Low   "
"1"," 0.90476"
"1"," 0.09524"
"1","
  Medium"
"1"," 0.68254"
"1"," 0.31746"
"1","
  High  "
"1"," 0.39683"
"1"," 0.60317"
"1","
"
"0","# 3. Kaplan-Meieræ›²ç·š"
"0","message(""\n--- Kaplan-Meier Analysis ---"")"
"2","
--- Kaplan-Meier Analysis ---
"
"0","km_fit <- survfit(Surv(time2y, recur_2y) ~ risk_group, "
"0","                  data = test_data)"
"0",""
"0","# Log-rankæ¤œå®š"
"0","survdiff_result <- survdiff(Surv(time2y, recur_2y) ~ risk_group, "
"0","                            data = test_data)"
"2","Error in survdiff(Surv(time2y, recur_2y) ~ risk_group, data = test_data) : 
  survdiff not defined for multi-state data
"
