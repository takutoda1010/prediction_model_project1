"0","# 必要パッケージ"
"0","# suppressPackageStartupMessages({"
"0","#   library(dplyr)"
"0","#   library(stringr)"
"0","#   library(forcats)"
"0","#   library(lubridate)"
"0","# })"
"0",""
"0","# 作業用データ（元データは ds00 ）"
"0","ds01 <- ds00"
"0",""
"0","# 列名の空白ゆらぎを正規化（全角/半角スペース、連続空白）"
"0","names(ds01) <- names(ds01) |>"
"0","  str_replace_all(""[\u3000\\s]+"", "" "") |>"
"0","  trimws()"
"0",""
"0","# --- ヘルパー関数 ---"
"0","as_date_safely <- function(x){"
"0","  if (inherits(x, ""Date"")) return(x)"
"0","  if (is.numeric(x)) return(as.Date(x, origin = ""1899-12-30""))"
"0","  suppressWarnings(as.Date(parse_date_time("
"0","    as.character(x),"
"0","    orders = c(""Ymd"",""Y-m-d"",""Y/m/d"",""mdY"",""dmy"",""dmY"",""Ymd HMS"",""Y-m-d HMS"",""Y/m/d H:M:S"")"
"0","  )))"
"0","}"
"0",""
"0","to_tf <- function(x){"
"0","  z <- trimws(as.character(x))"
"0","  z <- chartr(""＋－"", ""+-"", z)  # 全角→半角"
"0","  rec <- c(""TRUE""=""TRUE"",""T""=""TRUE"",""有""=""TRUE"",""Yes""=""TRUE"",""yes""=""TRUE"",""1""=""TRUE"",""+""=""TRUE"","
"0","           ""FALSE""=""FALSE"",""F""=""FALSE"",""無""=""FALSE"",""No""=""FALSE"",""no""=""FALSE"",""0""=""FALSE"",""-""=""FALSE"")"
"0","  as.logical(rec[z])  # 該当なしは NA"
"0","}"
"0",""
