"0",""
"0","# ========================================================================"
"0","# 7. メイン処理"
"0","# ========================================================================"
"0",""
"0","#' メインのデータ処理パイプライン"
"0","#' @param file_path 入力Excelファイルのパス"
"0","#' @return 処理済みデータのリスト"
"0","process_hcc_data <- function(file_path) {"
"0","  "
"0","  message(""========================================"")"
"0","  message(""HCCデータ処理開始"")"
"0","  message(""========================================"")"
"0","  "
"0","  # Step 1: データ読み込み"
"0","  message(""Step 1: データ読み込み..."")"
"0","  ds_raw <- load_and_preprocess(file_path)"
"0","  n_rows_original <- nrow(ds_raw)"
"0","  message(sprintf(""  読み込み完了: %d行"", n_rows_original))"
"0","  "
"0","  # Step 2: 列名のエイリアス適用"
"0","  message(""Step 2: 列名の統一..."")"
"0","  ds_aliased <- apply_column_aliases(ds_raw)"
"0","  "
"0","  # Step 3: 変数マッピング適用"
"0","  message(""Step 3: 変数変換..."")"
"0","  ds_mapped <- apply_variable_mapping(ds_aliased)"
"0","  "
"0","  # Step 4: 派生変数作成"
"0","  message(""Step 4: 派生変数作成..."")"
"0","  ds_with_stages <- create_stage_variables(ds_mapped)"
"0","  ds_with_death <- create_death_cause(ds_with_stages)"
"0","  "
"0","  # Step 5: モデル用データセット作成"
"0","  message(""Step 5: モデル用データセット作成..."")"
"0","  ds_model <- create_model_dataset(ds_with_death)"
"0","  "
"0","  # 結果確認"
"0","  n_rows_final <- nrow(ds_model)"
"0","  n_cols_final <- ncol(ds_model)"
"0","  "
"0","  message(""========================================"")"
"0","  message(""処理完了"")"
"0","  message(sprintf(""  最終データ: %d行 × %d列"", n_rows_final, n_cols_final))"
"0","  "
"0","  if (n_rows_original != n_rows_final) {"
"0","    warning(sprintf(""行数が変化しました: %d → %d"", n_rows_original, n_rows_final))"
"0","  }"
"0","  "
"0","  # 結果を返す"
"0","  return(list("
"0","    raw_data = ds_raw,          # 元データ"
"0","    processed_data = ds_with_death,  # 全処理済みデータ"
"0","    model_data = ds_model,      # モデル用データ"
"0","    metadata = list("
"0","      n_rows_original = n_rows_original,"
"0","      n_rows_final = n_rows_final,"
"0","      n_cols_final = n_cols_final,"
"0","      processing_date = Sys.Date()"
"0","    )"
"0","  ))"
"0","}"
