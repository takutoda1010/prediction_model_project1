"0","# ========================================================================"
"0","# 2. ヘルパー関数定義"
"0","# ========================================================================"
"0",""
"0","#' Excel日付・日時混在データをDate型に変換"
"0","#' @param x 変換対象のベクトル"
"0","#' @return Date型ベクトル"
"0","to_date_excel_mixed <- function(x) {"
"0","  if (inherits(x, ""Date"")) return(x)"
"0","  "
"0","  s <- trimws(as.character(x))"
"0","  s[s %in% c("""", ""NA"", ""N/A"", ""na"", ""n/a"")] <- NA"
"0","  "
"0","  # Excelシリアル値（1900年起算）の処理"
"0","  num <- suppressWarnings(as.numeric(s))"
"0","  dnum <- as.Date(num, origin = ""1899-12-30"")"
"0","  "
"0","  # 文字列日付の正規化"
"0","  s2 <- s |>"
"0","    stringr::str_replace_all(""[.]"", ""/"") |>"
"0","    stringr::str_replace_all(""年|月"", ""/"") |>"
"0","    stringr::str_replace_all(""日"", """") |>"
"0","    stringr::str_replace_all(""/"", ""-"")"
"0","  "
"0","  dchr <- suppressWarnings(lubridate::ymd(s2))"
"0","  "
"0","  # 文字列日付を優先、次にシリアル値"
"0","  as.Date(dplyr::coalesce(dchr, dnum))"
"0","}"
"0",""
"0","#' TRUE/FALSE表記の揺れを論理値に変換"
"0","#' @param x 変換対象のベクトル"
"0","#' @return logical型ベクトル"
"0","to_tf <- function(x) {"
"0","  z <- trimws(as.character(x))"
"0","  z <- chartr(""＋－"", ""+-"", z)"
"0","  "
"0","  rec <- c("
"0","    ""TRUE"" = ""TRUE"", ""T"" = ""TRUE"", ""有"" = ""TRUE"", ""Yes"" = ""TRUE"", "
"0","    ""yes"" = ""TRUE"", ""1"" = ""TRUE"", ""+"" = ""TRUE"","
"0","    ""FALSE"" = ""FALSE"", ""F"" = ""FALSE"", ""無"" = ""FALSE"", ""No"" = ""FALSE"", "
"0","    ""no"" = ""FALSE"", ""0"" = ""FALSE"", ""-"" = ""FALSE"""
"0","  )"
"0","  "
"0","  as.logical(rec[z])"
"0","}"
"0",""
"0","#' 時間表記を分に変換（H:MM:SS形式とExcel小数値に対応）"
"0","#' @param x 変換対象のベクトル"
"0","#' @return 分単位の数値ベクトル"
"0","to_minutes_from_time <- function(x) {"
"0","  s <- stringr::str_squish(as.character(x))"
"0","  s <- stringr::str_replace_all(s, ""："", "":"")"
"0","  "
"0","  has_colon <- stringr::str_detect(s, "":"")"
"0","  "
"0","  # コロン形式の処理"
"0","  parts <- stringr::str_split_fixed(s, "":"", 3)"
"0","  hh <- suppressWarnings(as.numeric(parts[, 1]))"
"0","  mm <- suppressWarnings(as.numeric(parts[, 2]))"
"0","  ss <- suppressWarnings(as.numeric(parts[, 3]))"
"0","  "
"0","  from_colon <- ifelse("
"0","    has_colon, "
"0","    hh * 60 + mm + ifelse(is.na(ss), 0, round(ss / 60)), "
"0","    NA_real_"
"0","  )"
"0","  "
"0","  # Excel小数値の処理（1日 = 1.0）"
"0","  num <- suppressWarnings(as.numeric(s))"
"0","  from_frac <- ifelse(!has_colon & !is.na(num), num * 1440, NA_real_)"
"0","  "
"0","  round(dplyr::coalesce(from_colon, from_frac))"
"0","}"
