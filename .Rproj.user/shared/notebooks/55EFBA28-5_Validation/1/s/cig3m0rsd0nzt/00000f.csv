"0","## ==== CAL-M7-CITL-0: 前提の取得（fit, データ, t*）============================="
"0","stopifnot(exists(""tst""))                # Testデータ（Surv-ready: time2y, event2y）"
"0","t_star <- 24"
"0",""
"0","# M7 の Cox fit を取得"
"0","get_m7_fit <- function(){"
"0","  if (exists(""model_results"") && !is.null(model_results[[""M7_LASSO_postCox""]])) {"
"0","    fr <- model_results[[""M7_LASSO_postCox""]]"
"0","    if (inherits(fr$fit, ""coxph"")) return(fr$fit)"
"0","    if (inherits(fr$fit_post, ""coxph"")) return(fr$fit_post)"
"0","  }"
"0","  if (exists(""fit_m7"") && inherits(fit_m7, ""coxph"")) return(fit_m7)"
"0","  stop(""M7 の Cox モデルが見つかりません（model_results[['M7_LASSO_postCox']]$fit などを確認）。"")"
"0","}"
"0","fit_m7 <- get_m7_fit()"
"0",""
"0","# Test の基本チェック"
"0","stopifnot(all(c(""time2y"",""event2y"") %in% names(tst)))"
"0","T_test <- as.numeric(tst$time2y)"
"0","D_test <- as.integer(tst$event2y)"
"0",""
