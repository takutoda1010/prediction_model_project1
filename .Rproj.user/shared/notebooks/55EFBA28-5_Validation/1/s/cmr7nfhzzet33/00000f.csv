"0","## ==== CAL-SLOPE-M7-1: Test LP (drop NA safely) =============================="
"0","stopifnot(exists(""tst""))"
"0",""
"0","# M7 の最終 Cox モデルを取得"
"0","fit_m7 <- if (exists(""fit_m7"")) fit_m7 else {"
"0","  stopifnot(!is.null(model_results[[""M7_LASSO_postCox""]]$fit))"
"0","  model_results[[""M7_LASSO_postCox""]]$fit"
"0","}"
"0",""
"0","# 線形予測子（LP）"
"0","lp_m7 <- suppressWarnings(as.numeric(predict(fit_m7, newdata = tst, type = ""lp"")))"
"0","keep  <- is.finite(lp_m7) & is.finite(tst$time2y) & is.finite(tst$event2y)"
"0",""
"0","if (sum(!keep) > 0) {"
"0","  message(sprintf(""[M7][cal-slope] Dropping %d rows with NA/Inf in LP or outcome."", sum(!keep)))"
"0","}"
"2","[M7][cal-slope] Dropping 1 rows with NA/Inf in LP or outcome.
"
"0","d_cal <- data.frame(time2y = tst$time2y[keep],"
"0","                    event2y = tst$event2y[keep],"
"0","                    LP      = lp_m7[keep])"
"0",""
