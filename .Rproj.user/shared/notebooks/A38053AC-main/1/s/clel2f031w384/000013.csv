"0","# ========================================================================"
"0","# 3. ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã¨ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°"
"0","# ========================================================================"
"0",""
"0","message(""\nğŸ“Š Data Processing Pipeline"")"
"2","
ğŸ“Š Data Processing Pipeline
"
"0","message(""----------------------------------------"")"
"2","----------------------------------------
"
"0","# 3.1 ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿"
"0","message(""\n[Step 1/7] Loading and preparing data..."")"
"2","
[Step 1/7] Loading and preparing data...
"
"0","dm <- load_and_prepare_data("
"0","  config_path = config_path,"
"0","  variables_path = variables_path"
"0",")"
"2","
========================================
"
"2","Starting Data Loading Pipeline
"
"2","========================================
"
"2","
ğŸ“„ Loading configuration files...
"
"2","
ğŸ“Š Loading raw data...
"
"2","
ğŸ“ Loading data from: BRåˆ†é¡ã§ç”Ÿå­˜è§£æã®ãƒ‡ãƒ¼ã‚¿update20251016.xlsx
"
"2","âœ… Data loaded: 990 rows Ã— 151 columns
"
"2","ğŸ“Œ Created dataset: ds00
"
"2","
ğŸ”§ Normalizing column names...
"
"2","ğŸ“Œ Created dataset: ds01
"
"2","
ğŸ”„ Applying column mapping...
"
"2","ğŸ“‹ Column mapping: 35 applied, 1 not found
"
"2","   Not found: ID...3
"
"2","ğŸ“Œ Created dataset: ds02
"
"2","
ğŸ“ Adjusting data types...
"
"2","Warning: Duplicated column names deduplicated: 'æ‰‹è¡“æ™‚ç¾¤åˆ†ã‘ R/BR1/BR2' => 'æ‰‹è¡“æ™‚ç¾¤åˆ†ã‘ R/BR1/BR2_1' [7], 'è¨ºæ–­æ™‚ç¾¤åˆ†ã‘ R/BR1/BR2' => 'è¨ºæ–­æ™‚ç¾¤åˆ†ã‘ R/BR1/BR2_1' [8], 'ç¾¤åˆ†ã‘ R/BR' => 'ç¾¤åˆ†ã‘ R/BR_1' [9], 'è¡“å‰æ²»ç™‚+/-' => 'è¡“å‰æ²»ç™‚+/-_1' [19], 'è¡“å‰æ²»ç™‚+/-' => 'è¡“å‰æ²»ç™‚+/-_2' [20], 'ID' => 'ID_1' [27]"
"2","ğŸ“Œ Created dataset: ds03
"
"2","
âœ”ï¸ Validating data...
"
"2","Data validation failed:
"
"2","  âŒ Missing required columns: id, op_date, os_months, rfs_months
"
"1","
=== Dataset Summary ===
"
"1","ds00: 990 rows Ã— 151 columns
"
"1","ds01: 990 rows Ã— 151 columns
"
"1","ds02: 990 rows Ã— 185 columns
"
"1","ds03: 990 rows Ã— 185 columns
"
"1","
Current version: ds03
"
"2","
âœ… Data loading pipeline completed!
"
"2","========================================

"
"0","# 3.2 ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°"
"0","message(""\n[Step 2/7] Cleaning data..."")"
"2","
[Step 2/7] Cleaning data...
"
"0","dm <- clean_data_pipeline(dm, config, variables)"
"2","
========================================
"
"2","Starting Data Cleaning Pipeline
"
"2","========================================
"
"2","
ğŸ§¹ Cleaning variable names...
"
"2","  Changed variable names:
"
"2","    'æ‰‹è¡“æ™‚ç¾¤åˆ†ã‘ R/BR1/BR2' â†’ 'æ‰‹è¡“æ™‚ç¾¤åˆ†ã‘_R_BR1_BR2'
"
"2","    'è¨ºæ–­æ™‚ç¾¤åˆ†ã‘ R/BR1/BR2' â†’ 'è¨ºæ–­æ™‚ç¾¤åˆ†ã‘_R_BR1_BR2'
"
"2","    'ç¾¤åˆ†ã‘ R/BR' â†’ 'ç¾¤åˆ†ã‘_R_BR'
"
"2","    'æ‰‹è¡“æ™‚ç¾¤åˆ†ã‘ R/BR1/BR2' â†’ 'æ‰‹è¡“æ™‚ç¾¤åˆ†ã‘_R_BR1_BR2'
"
"2","    'è¨ºæ–­æ™‚ç¾¤åˆ†ã‘ R/BR1/BR2' â†’ 'è¨ºæ–­æ™‚ç¾¤åˆ†ã‘_R_BR1_BR2'
"
"2","    'ç¾¤åˆ†ã‘ R/BR' â†’ 'ç¾¤åˆ†ã‘_R_BR'
"
"2","    'è¡“å‰æ²»ç™‚+/-' â†’ 'è¡“å‰æ²»ç™‚_plus_minus'
"
"2","    'è¡“å‰æ²»ç™‚+/-' â†’ 'è¡“å‰æ²»ç™‚_plus_minus'
"
"2","    'è¡“å‰æ²»ç™‚+/-' â†’ 'è¡“å‰æ²»ç™‚_plus_minus'
"
"2","    'date of birth' â†’ 'date_of_birth'
"
"2","    ... and 12 more
"
"2","ğŸ“Œ Created dataset: ds00
"
"2","
ğŸ·ï¸ Creating stage variables...
"
"2","Warning: argument 'pattern' has length > 1 and only the first element will be used"
"2","  âœ“ Created: stage_surg
"
"2","Warning: argument 'pattern' has length > 1 and only the first element will be used"
"2","  âœ“ Created: stage_diag
"
"2","Warning: argument 'pattern' has length > 1 and only the first element will be used"
"2","  âœ“ Created: group_rb
"
"2","ğŸ“Œ Created dataset: ds01
"
"2","
ğŸ’€ Creating death cause categories...
"
"2","  âœ“ Created: death_cause4
"
"2","  Distribution:
"
"2","    aliver: 629
"
"2","    Cancer: 262
"
"2","    LiverFailure: 26
"
"2","    Other: 73
"
"2","ğŸ“Œ Created dataset: ds02
"
"2","
âš™ï¸ Setting reference levels for categorical variables...
"
"2","  âœ“ sex: reference = 'F'
"
"2","  âœ“ group_rb: reference = 'R'
"
"2","  âœ“ stage_surg: reference = 'R'
"
"2","  âœ“ stage_diag: reference = 'R'
"
"2","ğŸ“Œ Created dataset: ds03
"
"2","
ğŸ“Š Setting ordered factors...
"
"2","  âœ“ vp_pre: ordered (0-4)
"
"2","  âœ“ vv_pre: ordered (0-4)
"
"2","  âœ“ vp_path: ordered (0-4)
"
"2","  âœ“ vv_path: ordered (0-4)
"
"2","  âœ“ fibrosis_score: ordered (0-4)
"
"2","  âœ“ grading_score: ordered (0-3)
"
"2","ğŸ“Œ Created dataset: ds04
"
"2","
ğŸ”§ Handling special variable codings...
"
"2","  âœ“ fc: converted -/+ to 0/1
"
"2","  âœ“ fc_inf: converted -/+ to 0/1
"
"2","  âœ“ sf: converted -/+ to 0/1
"
"2","  âœ“ sm: converted -/+ to 0/1
"
"2","  âœ“ im: standardized (0 vs 1+)
"
"2","  âœ“ hbv: factor levels set
"
"2","  âœ“ child_pugh: factor levels set (A/B/C)
"
"2","  âœ“ liver_damage: factor levels set (A/B/C)
"
"2","ğŸ“Œ Created dataset: ds05
"
"2","
ğŸ“… Processing date variables...
"
"2","  âœ“ Created: op_date from æ‰‹è¡“æ—¥
"
"2","  âœ“ Created: last_followup from æœ€çµ‚ç¢ºèªæ—¥
"
"2","  âœ“ Created: first_visit_dt from åˆè¨ºæ—¥
"
"2","  âœ“ Created: adm_dt from å…¥é™¢æ—¥
"
"2","  âœ“ Created: recur_date from å†ç™ºæ—¥
"
"2","ğŸ“Œ Created dataset: ds06
"
"2","
ğŸ“ Processing volume variables...
"
"2","ğŸ“Œ Created dataset: ds07
"
"2","
ğŸ” Performing data quality checks...
"
"2","  âš  plt out of range [0, 100]: 1 cases
"
"2","  âš  che out of range [0, 500]: 8 cases
"
"2","  âš  pt_inr out of range [0.5, 5]: 990 cases
"
"2","  âš  lhl15 out of range [0, 1]: 1 cases
"
"2","  âš  afp out of range [0, 1e+06]: 3 cases
"
"2","  âš  pivka2 out of range [0, 100000]: 28 cases
"
"2","  âš  count out of range [1, 100]: 3 cases
"
"2","
  Total issues found: 7 types
"
"2","ğŸ“Œ Created dataset: ds08
"
"1","
=== Dataset Summary ===
"
"1","ds00: 990 rows Ã— 185 columns
"
"1","ds01: 990 rows Ã— 188 columns
"
"1","ds02: 990 rows Ã— 189 columns
"
"1","ds03: 990 rows Ã— 189 columns
"
"1","ds04: 990 rows Ã— 189 columns
"
"1","ds05: 990 rows Ã— 189 columns
"
"1","ds06: 990 rows Ã— 194 columns
"
"1","ds07: 990 rows Ã— 194 columns
"
"1","ds08: 990 rows Ã— 194 columns
"
"1","
Current version: ds08
"
"2","
âœ… Data cleaning pipeline completed!
"
"2","========================================

"
"0","# 3.3 ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°"
"0","message(""\n[Step 3/7] Engineering features..."")"
"2","
[Step 3/7] Engineering features...
"
"0","dm <- feature_engineering_pipeline(dm, config, variables)"
"2","
========================================
"
"2","Starting Feature Engineering Pipeline
"
"2","========================================
"
"2","
ğŸ“Š Computing ALBI score...
"
"2","  âœ“ ALBI score: median = -2.73, range = [-3.67, -1.03]
"
"2","  âœ“ ALBI grade distribution:
"
"2","    Grade 1: 631 (63.7%)
"
"2","    Grade 2: 355 (35.9%)
"
"2","    Grade 3: 2 (0.2%)
"
"2","    Grade NA: 2 (0.2%)
"
"2","ğŸ“Œ Created dataset: ds00
"
"2","
ğŸ“ Computing BMI...
"
"2","  âœ“ BMI: median = 23.4, range = [12.0, 42.4]
"
"2","ğŸ“Œ Created dataset: ds01
"
"2","
ğŸ”¬ Creating vascular invasion variables...
"
"2","  âœ“ microVI: 203 cases (20.5%)
"
"2","  âœ“ macroVI: 139 cases (14.0%)
"
"2","ğŸ“Œ Created dataset: ds02
"
"2","
â±ï¸ Creating time-related variables...
"
"2","  âœ“ Created rfs_months from ç„¡å†ç™ºç”Ÿå­˜æœŸé–“
"
"2","  âœ“ Created os_months from å…¨ç”Ÿå­˜æœŸé–“m
"
"2","  âœ“ Created recur_tf from å†ç™ºæœ‰ç„¡TRUE_FALSEã®äºŒç¾¤
"
"2","  âœ“ Created vital_status from ç”Ÿæ­»
"
"2","  âœ“ Created vital10 from ç”Ÿ1æ­»0
"
"2","  âœ“ time2y: created (median = 16.0 months)
"
"2","  âœ“ recur_2y: 420 events (42.4%)
"
"2","  âœ“ eventfree_2y: 510 event-free (51.5%)
"
"2","  âœ“ vital_2y: 813 alive at 2y (82.1%)
"
"2","ğŸ“Œ Created dataset: ds03
"
"2","
ğŸ“ˆ Transforming skewed variables...
"
"2","  âœ“ afp_log1p: created (skew = 25.21)
"
"2","  âœ“ afp_l3_log1p: created (skew = 1.38)
"
"2","  âœ“ pivka2_log1p: created (skew = 8.97)
"
"2","  âœ“ cea_log1p: created (skew = 4.41)
"
"2","  âœ“ ca19_9_log1p: created (skew = 8.87)
"
"2","  âœ“ ast_log1p: created (skew = 5.97)
"
"2","  âœ“ alt_log1p: created (skew = 2.67)
"
"2","  âœ“ tbil_log1p: created (skew = 10.75)
"
"2","  âœ“ plt_log1p: created (skew = 10.50)
"
"2","  âœ“ icg_r15_log1p: created (skew = 2.46)
"
"2","  âœ“ lhl15_log1p: created (skew = 29.58)
"
"2","  âœ“ tum_diam_pre_log1p: created (skew = 1.31)
"
"2","  âœ“ tum_count_pre_log1p: created (skew = 4.58)
"
"2","  âœ“ max_diam_cm_log1p: created (skew = 1.60)
"
"2","  Total transformations: 14
"
"2","ğŸ“Œ Created dataset: ds04
"
"2","
ğŸ”§ Handling missing values...
"
"2","  âš  Removing 44 variables with >30% missing:
"
"2","    - æ²»ç™‚å‰Méƒ¨ä½ (99.8% missing)
"
"2","    - æ²»ç™‚å‰AFP (99.2% missing)
"
"2","    - æ²»ç™‚å‰PIVKA2 (99.2% missing)
"
"2","    - æ²»ç™‚å‰Child (99.0% missing)
"
"2","    - é›»è©± (99.7% missing)
"
"2","
  Applying median imputation...
"
"2","    æ‰‹è¡“ç•ªå·: 10 values imputed (median = 2730.50)
"
"2","    ChE: 26 values imputed (median = 252.00)
"
"2","    ICG: 4 values imputed (median = 13.45)
"
"2","    HH15: 90 values imputed (median = 0.60)
"
"2","    LHL15: 87 values imputed (median = 0.92)
"
"2","    AFP_L3: 23 values imputed (median = 3.10)
"
"2","    CEA: 140 values imputed (median = 3.20)
"
"2","    CA199: 150 values imputed (median = 22.35)
"
"2","    èº«é•·: 259 values imputed (median = 163.60)
"
"2","    ä½“é‡: 258 values imputed (median = 62.80)
"
"2","    å‡ºè¡€é‡: 2 values imputed (median = 330.00)
"
"2","    åˆ‡é™¤è‚é‡é‡: 79 values imputed (median = 270.00)
"
"2","    CaNo: 50 values imputed (median = 1.00)
"
"2","    va: 10 values imputed (median = 0.00)
"
"2","    t: 2 values imputed (median = 2.00)
"
"2","    m: 1 values imputed (median = 0.00)
"
"2","    è¡“å¾ŒTBilå€¤: 244 values imputed (median = 0.00)
"
"2","    è¡“å¾Œåˆä½µç—‡: 244 values imputed (median = 0.00)
"
"2","    åˆä½µç—‡èƒ¸æ°´_0_minus2ã®é †åºå¤‰æ•°: 131 values imputed (median = 0.00)
"
"2","    åˆä½µç—‡å‘¼å¸å™¨: 131 values imputed (median = 0.00)
"
"2","    åˆä½µç—‡å‡ºè¡€_0_minus2ã®é †åºå¤‰æ•°: 129 values imputed (median = 0.00)
"
"2","    åˆä½µç—‡è…¹æ°´: 131 values imputed (median = 0.00)
"
"2","    åˆä½µç—‡èƒ†æ±æ¼é †åºå¤‰æ•°: 128 values imputed (median = 0.00)
"
"2","    åˆä½µç—‡æ¶ˆåŒ–ç®¡é †åºå¤‰æ•°: 131 values imputed (median = 0.00)
"
"2","    åˆä½µç—‡è¡“å‰µé †åºå¤‰æ•°: 136 values imputed (median = 0.00)
"
"2","    height_cm: 259 values imputed (median = 163.60)
"
"2","    weight_kg: 258 values imputed (median = 62.80)
"
"2","    che: 26 values imputed (median = 252.00)
"
"2","    icg_r15: 4 values imputed (median = 13.45)
"
"2","    hh15: 90 values imputed (median = 0.60)
"
"2","    lhl15: 87 values imputed (median = 0.92)
"
"2","    afp_l3: 23 values imputed (median = 3.10)
"
"2","    cea: 140 values imputed (median = 3.20)
"
"2","    ca19_9: 150 values imputed (median = 22.35)
"
"2","    count: 1 values imputed (median = 1.00)
"
"2","    ALBIscore: 2 values imputed (median = -2.73)
"
"2","    BMI: 259 values imputed (median = 23.44)
"
"2","    afp_l3_log1p: 23 values imputed (median = 1.41)
"
"2","    cea_log1p: 140 values imputed (median = 1.44)
"
"2","    ca19_9_log1p: 150 values imputed (median = 3.15)
"
"2","    icg_r15_log1p: 4 values imputed (median = 2.67)
"
"2","    lhl15_log1p: 87 values imputed (median = 0.65)
"
"2","    HB: 20 values imputed (mode = -)
"
"2","    HBæ„ŸæŸ“æ—¢å¾€: 135 values imputed (mode = +)
"
"2","    HCV: 21 values imputed (mode = -)
"
"2","    è…«ç˜åˆ†é¡: 1 values imputed (mode = HCC)
"
"2","    åˆè¨ºæ—¥: 18 values imputed (mode = 2014/03/03)
"
"2","    ICG_10%æœªæº€: 58 values imputed (mode = ICG 10%ä»¥ä¸Š)
"
"2","    liver_damage: 16 values imputed (mode = A)
"
"2","    AFP500ä»¥ä¸Š: 45 values imputed (mode = AFP500æœªæº€)
"
"2","    PIVKA2_200ä»¥ä¸Š: 49 values imputed (mode = PIVKA2 200æœªæº€)
"
"2","    æ‰‹è¡“ç—…å: 1 values imputed (mode = HCC)
"
"2","    çµ±è¨ˆç”¨æ‰‹è¡“ç—…å: 42 values imputed (mode = HCC)
"
"2","    è¡“å¼: 2 values imputed (mode = è‚å³è‘‰åˆ‡é™¤)
"
"2","    è¡“å¼åˆ†é¡: 42 values imputed (mode = è‚(æ‹¡å¤§)å³è‘‰åˆ‡é™¤)
"
"2","    æ‰‹è¡“æ™‚é–“: 2 values imputed (mode = 5:00)
"
"2","    è¡“è€…: 10 values imputed (mode = ç¥å±± ä¿Šå“‰)
"
"2","    Pringle: 42 values imputed (mode = å…¨è‚)
"
"2","    é–‹èƒ¸é–‹è…¹: 2 values imputed (mode = FALSE)
"
"2","    åˆ‡é™¤æ²»ç™‚æ™‚æ²»ç™’åº¦: 10 values imputed (mode = è‚åˆ‡é™¤ä¸­å¿ƒã®æ²»ç™‚ã«ã‚ˆã‚Šéºæ®‹ç—…å¤‰ç„¡ã—)
"
"2","    ç—…ç†ç•ªå·: 10 values imputed (mode = 000020)
"
"2","    åˆ†åŒ–åº¦: 2 values imputed (mode = mod)
"
"2","    çµ„ç¹”å‹: 232 values imputed (mode = trabecular)
"
"2","    ç™ºè‚²: 18 values imputed (mode = eg)
"
"2","    fc: 17 values imputed (mode = 1)
"
"2","    fc_inf: 74 values imputed (mode = 1)
"
"2","    sf: 22 values imputed (mode = 1)
"
"2","    im: 154 values imputed (mode = 0)
"
"2","    sm: 28 values imputed (mode = 0)
"
"2","    stage: 3 values imputed (mode = 2)
"
"2","    StageI_plusII_or_III_plusIVã€€éç™Œéƒ¨è‚_æ—§å…¥åŠ›ï¼‰: 45 values imputed (mode = III+IV)
"
"2","    éç™Œéƒ¨è‚: 89 values imputed (mode = CH)
"
"2","    fibrosis_score: 60 values imputed (mode = 2)
"
"2","    grading_score: 192 values imputed (mode = 1)
"
"2","    hbv: 20 values imputed (mode = -)
"
"2","    ALBIgrade: 2 values imputed (mode = 1)
"
"2","    BMI_category: 259 values imputed (mode = Normal)
"
"2","    è‚å†åˆ‡é™¤: 43 values imputed (mode = FALSE)
"
"2","    Hx: 42 values imputed (mode = TRUE)
"
"2","
  âš  Warning: 7 variables still have missing values:
"
"2","    - æ‰‹è¡“æ™‚ç¾¤åˆ†ã‘_R_BR1_BR2: 0.0% missing
"
"2","    - è¨ºæ–­æ™‚ç¾¤åˆ†ã‘_R_BR1_BR2: 0.0% missing
"
"2","    - ç¾¤åˆ†ã‘_R_BR: 0.0% missing
"
"2","    - å…¥é™¢æ—¥: 0.8% missing
"
"2","    - first_visit_dt: 1.8% missing
"
"2","ğŸ“Œ Created dataset: ds05
"
"2","
ğŸ“‹ Preparing variable sets...
"
"2","  Variable set 'model_all_candidates':
"
"2","    Requested: 43 variables
"
"2","    Available: 39 variables
"
"2","    Missing: op_time_min, bleed_ml_log1p, specimen_wt_log1p, growth_type
"
"1","
=== Dataset Summary ===
"
"1","ds00: 990 rows Ã— 196 columns
"
"1","ds01: 990 rows Ã— 198 columns
"
"1","ds02: 990 rows Ã— 200 columns
"
"1","ds03: 990 rows Ã— 209 columns
"
"1","ds04: 990 rows Ã— 223 columns
"
"1","ds05: 990 rows Ã— 177 columns
"
"1","ds06: 990 rows Ã— 194 columns
"
"1","ds07: 990 rows Ã— 194 columns
"
"1","ds08: 990 rows Ã— 194 columns
"
"1","
Current version: ds05
"
"2","
ğŸ“Š Feature Engineering Summary:
"
"2","  Total variables: 223
"
"2","  Numeric variables: 118
"
"2","  Factor variables: 24
"
"2","  Derived variables created: 24
"
"2","
âœ… Feature engineering pipeline completed!
"
"2","========================================

"
"0","# æœ€çµ‚ãƒ‡ãƒ¼ã‚¿ã®å–å¾—"
"0","final_data <- dm$get_current()"
"0",""
"0","# æ¬ æå€¤ã®è£œå®Œ"
"0","final_data <- handle_missing_values(final_data, config, method = ""median"")"
"2","
ğŸ”§ Handling missing values...
"
"2","
  Applying median imputation...
"
"2","
  âš  Warning: 7 variables still have missing values:
"
"2","    - æ‰‹è¡“æ™‚ç¾¤åˆ†ã‘_R_BR1_BR2: 0.0% missing
"
"2","    - è¨ºæ–­æ™‚ç¾¤åˆ†ã‘_R_BR1_BR2: 0.0% missing
"
"2","    - ç¾¤åˆ†ã‘_R_BR: 0.0% missing
"
"2","    - å…¥é™¢æ—¥: 0.8% missing
"
"2","    - first_visit_dt: 1.8% missing
"
"0","message(sprintf(""\n  âœ“ Final dataset: %d rows Ã— %d columns"", "
"0","               nrow(final_data), ncol(final_data)))"
"2","
  âœ“ Final dataset: 990 rows Ã— 177 columns
"
"0","# ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰"
"0","if (config$runtime$save_intermediate) {"
"0","  saveRDS(final_data, file.path(paths$output, ""processed_data.rds""))"
"0","  message(""  âœ“ Processed data saved"")"
"0","}"
"2","  âœ“ Processed data saved
"
