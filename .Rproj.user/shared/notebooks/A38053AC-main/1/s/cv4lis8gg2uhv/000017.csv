"0","# ========================================================================"
"0","# 4. ãƒ‡ãƒ¼ã‚¿åˆ†å‰²"
"0","# ========================================================================"
"0",""
"0","message(""\n[Step 4/7] Splitting data..."")"
"2","
[Step 4/7] Splitting data...
"
"0","message(""----------------------------------------"")"
"2","----------------------------------------
"
"0","# åˆ†å‰²æ–¹æ³•ã®å–å¾—"
"0","split_method <- ifelse(!is.null(config$model$split_method), "
"0","                       config$model$split_method, "
"0","                       ""temporal"")"
"0",""
"0","# äºˆæ¸¬æœŸé–“ã®å–å¾—"
"0","prediction_months <- ifelse(!is.null(config$model$prediction_time),"
"0","                           config$model$prediction_time,"
"0","                           24)"
"0",""
"0","# åŸºæº–æ—¥ã®è¨­å®š"
"0","reference_date <- Sys.Date()"
"0","if (!is.null(config$model$reference_date)) {"
"0","  reference_date <- as.Date(config$model$reference_date)"
"0","}"
"0",""
"0","# ãƒ‡ãƒ¼ã‚¿åˆ†å‰²å®Ÿè¡Œ"
"0","split_data <- split_data_pipeline("
"0","  df = final_data,"
"0","  config = config,"
"0","  method = split_method,"
"0","  prediction_months = prediction_months,"
"0","  reference_date = ""auto"","
"0","  create_cv = TRUE"
"0",")"
"2","
========================================
"
"2","Starting Data Splitting Pipeline
"
"2","========================================
"
"2","âš  Latest data too recent, using today as reference
"
"2","
ğŸ“… Performing temporal split with prediction window...
"
"2","  Reference date: 2025-11-13
"
"2","  Prediction window: 24 months
"
"2","  Cutoff date: 2023-11-13
"
"2","  âš  Excluded 45 cases with op_date after cutoff
"
"2","    Date range of excluded: 2023-11-21 to 2025-01-31
"
"2","
  âœ“ Eligible cases: 945 (before 2023-11-13)
"
"2","  âœ“ Train: n=567 (2000-01-04 to 2015-02-13)
"
"2","  âœ“ Val:   n=189 (2015-02-17 to 2019-08-01)
"
"2","  âœ“ Test:  n=189 (2019-08-02 to 2023-10-26)
"
"2","
  Verifying prediction window coverage:
"
"2","    Train: âœ“ Latest case has 129.0 months follow-up (>= 24 months)
"
"2","    Val: âœ“ Latest case has 75.4 months follow-up (>= 24 months)
"
"2","    Test: âœ“ Latest case has 24.6 months follow-up (>= 24 months)
"
"2","
ğŸ“Š Creating CV folds for training data...
"
"2","
ğŸ”„ Creating 5-fold cross-validation splits...
"
"2","  Random seed: 20251102
"
"2","  Using stratified CV
"
"2","  âœ“ Created 5 folds
"
"2","  âœ“ Fold sizes: min=112, max=114, mean=113.4
"
"2","  CV stratification check:
"
"2","    Event rates: mean=49.0%, sd=0.2%
"
"2","
ğŸ“ˆ Split Summary:
"
"2","  Method: temporal
"
"2","  Prediction window: 24 months
"
"2","  Reference date: 2025-11-13
"
"2","  Total samples: 990
"
"2","  Excluded (too recent): 45
"
"2","  Training: 567 (60.0%)
"
"2","  Validation: 189 (20.0%)
"
"2","  Test: 189 (20.0%)
"
"2","  CV folds: 5
"
"2","
âœ… Data splitting completed!
"
"2","========================================

"
"0","# åˆ†å‰²çµæœã®ä¿å­˜"
"0","if (config$runtime$save_intermediate) {"
"0","  save_split(split_data, file.path(paths$output_models, ""data_split.rds""))"
"0","  message(""  âœ“ Data split saved"")"
"0","}"
"2","  âœ“ Split saved to: /Users/yoshidatakuto/Dropbox/Hokkaido University/å¤§å­¦é™¢åŒ»å­¦é™¢/Borderline HCC/Prediction model_Project1/03_Output/models/data_split.rds
"
"2","  âœ“ Data split saved
"
