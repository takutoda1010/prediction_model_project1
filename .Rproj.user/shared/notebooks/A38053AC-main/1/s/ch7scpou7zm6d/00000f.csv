"0","# ========================================================================"
"0","# Table 1: æ‚£è€…èƒŒæ™¯ã®ä½œæˆ"
"0","# ========================================================================"
"0",""
"0","message(""\n========================================"")"
"2","
========================================
"
"0","message(""Creating Table 1: Baseline Characteristics"")"
"2","Creating Table 1: Baseline Characteristics
"
"0","message(""========================================\n"")"
"2","========================================

"
"0","create_table1 <- function(data_list, output_file = NULL) {"
"0","  require(tableone)"
"0","  require(dplyr)"
"0","  "
"0","  # ãƒ‡ãƒ¼ã‚¿ã‚’çµåˆï¼ˆå…¨ä½“ç”¨ï¼‰"
"0","  all_data <- rbind("
"0","    cbind(data_list$train, dataset = ""Train""),"
"0","    cbind(data_list$val, dataset = ""Validation""),"
"0","    cbind(data_list$test, dataset = ""Test"")"
"0","  )"
"0","  all_data$dataset <- factor(all_data$dataset, levels = c(""Train"", ""Validation"", ""Test""))"
"0","  "
"0","  # Table 1ç”¨ã®å¤‰æ•°ã‚’é¸æŠ"
"0","  vars_continuous <- c("
"0","    ""age"", ""alb"", ""tbil"", ""ast"", ""alt"", ""plt"", "
"0","    ""pt_inr"", ""afp"", ""pivka2"", ""max_diam_cm"", ""count"","
"0","    ""ALBIscore"", ""BMI"", ""icg_r15"""
"0","  )"
"0","  "
"0","  vars_categorical <- c("
"0","    ""sex"", ""hbv"", ""child_pugh"", ""liver_damage"", "
"0","    ""stage_diag"", ""ALBIgrade"", ""microVI"", ""macroVI"","
"0","    ""fc"", ""fc_inf"", ""sm"", ""t"", ""n"", ""m"""
"0","  )"
"0","  "
"0","  # åˆ©ç”¨å¯èƒ½ãªå¤‰æ•°ã®ã¿é¸æŠ"
"0","  vars_continuous <- intersect(vars_continuous, names(all_data))"
"0","  vars_categorical <- intersect(vars_categorical, names(all_data))"
"0","  "
"0","  # ã™ã¹ã¦ã®å¤‰æ•°"
"0","  all_vars <- c(vars_continuous, vars_categorical)"
"0","  "
"0","  # ã‚¢ã‚¦ãƒˆã‚«ãƒ å¤‰æ•°"
"0","  outcome_vars <- c(""recur_2y"", ""time2y"")"
"0","  "
"0","  # å› å­å¤‰æ•°ã¨ã—ã¦æŒ‡å®š"
"0","  factor_vars <- vars_categorical"
"0","  "
"0","  # Table 1ã‚’ä½œæˆ"
"0","  table1 <- CreateTableOne("
"0","    vars = c(all_vars, outcome_vars),"
"0","    strata = ""dataset"","
"0","    data = all_data,"
"0","    factorVars = factor_vars,"
"0","    addOverall = TRUE"
"0","  )"
"0","  "
"0","  # è¡¨ç¤ºç”¨ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ"
"0","  table1_print <- print("
"0","    table1,"
"0","    nonnormal = vars_continuous,  # ä¸­å¤®å€¤ï¼ˆIQRï¼‰ã§è¡¨ç¤º"
"0","    quote = FALSE,"
"0","    noSpaces = TRUE,"
"0","    printToggle = FALSE,"
"0","    showAllLevels = TRUE,"
"0","    cramVars = c(""stage_diag"", ""ALBIgrade""),  # ä¸€è¡Œã«ã¾ã¨ã‚ã‚‹"
"0","    test = TRUE,  # på€¤ã‚’è¨ˆç®—"
"0","    smd = TRUE    # SMDã‚‚è¨ˆç®—"
"0","  )"
"0","  "
"0","  # ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã«å¤‰æ›"
"0","  table1_df <- as.data.frame(table1_print)"
"0","  table1_df$Variable <- rownames(table1_df)"
"0","  table1_df <- table1_df[, c(""Variable"", names(table1_df)[names(table1_df) != ""Variable""])]"
"0","  rownames(table1_df) <- NULL"
"0","  "
"0","  # ã‚ˆã‚Šèª­ã¿ã‚„ã™ã„å¤‰æ•°åã«å¤‰æ›´"
"0","  var_labels <- c("
"0","    ""age"" = ""Age (years)"","
"0","    ""sex"" = ""Sex"","
"0","    ""alb"" = ""Albumin (g/dL)"","
"0","    ""tbil"" = ""Total bilirubin (mg/dL)"","
"0","    ""ast"" = ""AST (IU/L)"","
"0","    ""alt"" = ""ALT (IU/L)"","
"0","    ""plt"" = ""Platelet count (Ã—10â´/Î¼L)"","
"0","    ""pt_inr"" = ""PT-INR"","
"0","    ""afp"" = ""AFP (ng/mL)"","
"0","    ""pivka2"" = ""PIVKA-II (mAU/mL)"","
"0","    ""max_diam_cm"" = ""Maximum tumor diameter (cm)"","
"0","    ""count"" = ""Number of tumors"","
"0","    ""child_pugh"" = ""Child-Pugh class"","
"0","    ""liver_damage"" = ""Liver damage grade"","
"0","    ""stage_diag"" = ""Stage"","
"0","    ""ALBIscore"" = ""ALBI score"","
"0","    ""ALBIgrade"" = ""ALBI grade"","
"0","    ""microVI"" = ""Microvascular invasion"","
"0","    ""macroVI"" = ""Macrovascular invasion"","
"0","    ""recur_2y"" = ""2-year recurrence"","
"0","    ""time2y"" = ""Follow-up time (months)"""
"0","  )"
"0","  "
"0","  # å¤‰æ•°åã‚’ç½®æ›"
"0","  for (old_name in names(var_labels)) {"
"0","    table1_df$Variable <- gsub(paste0(""^"", old_name, ""$""), "
"0","                              var_labels[old_name], "
"0","                              table1_df$Variable)"
"0","  }"
"0","  "
"0","  # CSVã¨ã—ã¦ä¿å­˜"
"0","  if (!is.null(output_file)) {"
"0","    write.csv(table1_df, output_file, row.names = FALSE)"
"0","    message(sprintf(""âœ“ Table 1 saved to: %s"", basename(output_file)))"
"0","  }"
"0","  "
"0","  return(table1_df)"
"0","}"
"0",""
"0","# Table 1ã‚’ä½œæˆ"
"0","table1_result <- create_table1("
"0","  data_list = split_data_fixed,"
"0","  output_file = file.path(paths$output_tables, ""table1_baseline_characteristics.csv"")"
"0",")"
"2","âœ“ Table 1 saved to: table1_baseline_characteristics.csv
"
"0","# è¡¨ç¤º"
"0","message(""\nğŸ“‹ Table 1 Preview (first 20 rows):"")"
"2","
ğŸ“‹ Table 1 Preview (first 20 rows):
"
"0","print(head(table1_result, 20))"
