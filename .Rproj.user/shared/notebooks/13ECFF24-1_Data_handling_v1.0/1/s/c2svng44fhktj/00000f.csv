"0","# ---- 3-3. Basics / groups ----"
"0","# 手術時/診断時 R/BR1/BR2（列名の空白ゆらぎに強い取得）"
"0","c_surg <- grep(""手術時群分け\\s*R\\s*/\\s*BR1\\s*/\\s*BR2"", names(ds01), value = TRUE, perl = TRUE)"
"0","if (length(c_surg))"
"0","  ds01 <- ds01 |> dplyr::mutate(stage_surg = factor(.data[[c_surg[1]]], levels = c(""R"",""BR1"",""BR2"")))"
"0",""
"0","c_diag <- grep(""診断時群分け\\s*R\\s*/\\s*BR1\\s*/\\s*BR2"", names(ds01), value = TRUE, perl = TRUE)"
"0","if (length(c_diag))"
"0","  ds01 <- ds01 |> dplyr::mutate(stage_diag = factor(.data[[c_diag[1]]], levels = c(""R"",""BR1"",""BR2"")))"
"0",""
"0","# 群分け R/BR（BR1/BR2 を BR に寄せる）"
"0","c_rb <- grep(""^群分け\\s*R\\s*/\\s*BR"", names(ds01), value = TRUE, perl = TRUE)"
"0","if (length(c_rb))"
"0","  ds01 <- ds01 |> dplyr::mutate(group_rb = {"
"0","    x <- stringr::str_squish(as.character(.data[[c_rb[1]]]))"
"0","    x <- ifelse(x %in% c(""BR1"",""BR2""), ""BR"", x)"
"0","    factor(x, levels = c(""R"",""BR""))"
"0","  })"
"0",""
"0",""
