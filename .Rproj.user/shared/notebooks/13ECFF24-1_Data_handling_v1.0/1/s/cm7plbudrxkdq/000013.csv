"0","# ---- Q1: 欠けている4列を安全に作る（元の列がある場合のみ） ----"
"0","# stage_surg / stage_diag"
"0","if (!""stage_surg"" %in% names(ds01) && ""手術時群分け R/BR1/BR2"" %in% names(ds01)) {"
"0","  ds01$stage_surg <- ds01$`手術時群分け R/BR1/BR2`"
"0","}"
"0","if (!""stage_diag"" %in% names(ds01) && ""診断時群分け R/BR1/BR2"" %in% names(ds01)) {"
"0","  ds01$stage_diag <- ds01$`診断時群分け R/BR1/BR2`"
"0","}"
"0",""
"0","# group_rb：優先順位 = 1) 群分け R/BR → 2) stage_surg → 3) stage_diag"
"0","if (!""group_rb"" %in% names(ds01)) {"
"0","  if (""群分け R/BR"" %in% names(ds01)) {"
"0","    g <- stringr::str_squish(as.character(ds01$`群分け R/BR`))"
"0","    g[g %in% c(""BR1"",""BR2"")] <- ""BR"""
"0","    ds01$group_rb <- g"
"0","  } else if (""stage_surg"" %in% names(ds01)) {"
"0","    g <- as.character(ds01$stage_surg); g[g %in% c(""BR1"",""BR2"")] <- ""BR""; ds01$group_rb <- g"
"0","  } else if (""stage_diag"" %in% names(ds01)) {"
"0","    g <- as.character(ds01$stage_diag); g[g %in% c(""BR1"",""BR2"")] <- ""BR""; ds01$group_rb <- g"
"0","  }"
"0","}"
"0",""
"0","# nc_liver_stage_old：候補名のどれかがあればコピー"
"0","cand_nc <- intersect(names(ds01), c(""StageI+II or III+IV　非癌部肝(旧入力）"", ""StageI+II or III+IV""))"
"0","if (!""nc_liver_stage_old"" %in% names(ds01) && length(cand_nc) >= 1) {"
"0","  ds01$nc_liver_stage_old <- ds01[[cand_nc[1]]]"
"0","}"
"0",""
"0","# ds01_model を再構築（この4列を sel_cols に追加してから）"
"0","sel_cols <- unique(c(sel_cols, ""stage_surg"",""stage_diag"",""group_rb"",""nc_liver_stage_old""))"
"0","ds01_model <- ds01 |> dplyr::select(dplyr::any_of(sel_cols))"
"0",""
"0","# ざっと確認"
"0","c(""stage_surg"",""stage_diag"",""group_rb"",""nc_liver_stage_old"") %in% names(ds01_model)"
"1","[1]"
"1"," TRUE"
"1"," TRUE"
"1"," TRUE"
"1"," TRUE"
"1","
"
