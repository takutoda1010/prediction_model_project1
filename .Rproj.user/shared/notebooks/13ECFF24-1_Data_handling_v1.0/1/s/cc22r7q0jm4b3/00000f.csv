"0","# ---- 3-5. Dates & outcomes ----"
"0","if (""date of birth"" %in% names(ds01)) ds01$dob            <- to_date_excel_mixed(ds01$`date of birth`)"
"0","if (""最終確認日""     %in% names(ds01)) ds01$last_followup  <- to_date_excel_mixed(ds01$`最終確認日`)"
"0","if (""初診日""         %in% names(ds01)) ds01$first_visit_dt <- to_date_excel_mixed(ds01$`初診日`)"
"0","if (""入院日""         %in% names(ds01)) ds01$adm_dt         <- to_date_excel_mixed(ds01$`入院日`)"
"0","if (""再発日""         %in% names(ds01)) ds01$recur_date     <- to_date_excel_mixed(ds01$`再発日`)"
"0",""
"0","if (""年齢"" %in% names(ds01)) ds01$age <- suppressWarnings(as.numeric(ds01$`年齢`))"
"0","if (""60未満、60以上"" %in% names(ds01)) ds01$age_grp60 <- ds01$`60未満、60以上`"
"0","if (""性別"" %in% names(ds01)) ds01$sex <- suppressWarnings(as.factor(ds01$`性別`)) "
"0","if (""全生存期間m"" %in% names(ds01)) ds01$os_months <- suppressWarnings(as.numeric(ds01$`全生存期間m`))"
"0","if (""生死"" %in% names(ds01))    ds01$vital_status <- ds01$`生死`"
"0","if (""生1死0"" %in% names(ds01))  ds01$vital10      <- ds01$`生1死0`"
"0",""
"0","# 死因4群（欠損→aliver、指定4種→Other）：原データは残す"
"0","if (""死因"" %in% names(ds01)) {"
"0","  y <- stringr::str_squish(as.character(ds01$`死因`))"
"0","  other_pat <- ""(他病死(（老衰）|\\(老衰\\))?|敗血症|死（原因不明）|死\\(原因不明\\))"""
"0","  ds01$death_cause4 <- dplyr::case_when("
"0","    is.na(y) | y == """"                        ~ ""aliver"","
"0","    stringr::str_detect(y,""癌"")               ~ ""Cancer"","
"0","    stringr::str_detect(y,""肝不全"")           ~ ""LiverFailure"","
"0","    stringr::str_detect(y, other_pat)         ~ ""Other"","
"0","    TRUE                                      ~ ""Other"""
"0","  ) |> factor(levels = c(""aliver"",""Cancer"",""LiverFailure"",""Other""))"
"0","}"
"0",""
"0","if (""再発有無TRUE/FALSEの二群"" %in% names(ds01)) ds01$recur_tf   <- to_tf(ds01$`再発有無TRUE/FALSEの二群`)"
"0","if (""無再発生存期間"" %in% names(ds01))            ds01$rfs_months <- suppressWarnings(as.numeric(ds01$`無再発生存期間`))"
"0","if (""再発or死0"" %in% names(ds01))                 ds01$eventfree10 <- ds01$`再発or死0`"
"0",""
