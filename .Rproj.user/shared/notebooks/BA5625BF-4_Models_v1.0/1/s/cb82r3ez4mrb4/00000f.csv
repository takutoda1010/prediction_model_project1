"0","## ==== CHUNK M7-3: extract selected variables at λ* (map to original vars) ==="
"0","# 係数（列は X_tr の列名 = ダミー含む）"
"0","beta_hat <- as.matrix(coef(fit_glmnet, s = lambda_star))"
"0","nz_idx   <- which(abs(beta_hat) > 0)"
"0","nz_cols  <- rownames(beta_hat)[nz_idx]"
"0",""
"0","# model.matrix の ""assign"" 属性で列→元変数を取得"
"0","mm_tmp     <- model.matrix(form_x, data = trn)  # (Intercept)含む"
"0","assign_vec <- attr(mm_tmp, ""assign"")            # 各列がどの term か（0 は切片）"
"0","term_labs  <- attr(terms(form_x), ""term.labels"")"
"0","# 切片を除いた部分の assign を対応づけ"
"0","assign_noint <- assign_vec[colnames(mm_tmp) != ""(Intercept)""]"
"0","orig_var_by_col <- term_labs[ assign_noint ]    # 長さ = ncol(X_tr) と一致"
"0",""
"0","# 選択された元変数（ダミー列→親変数に集約）"
"0","sel_vars <- unique(orig_var_by_col[ match(nz_cols, colnames(X_tr)) ])"
"0","sel_vars <- sel_vars[!is.na(sel_vars)]"
"0",""
"0","cat(sprintf(""[M7] Non-zero variables at λ*: %d vars\n"", length(sel_vars)))"
"1","[M7] Non-zero variables at λ*: 13 vars
"
"0","print(sel_vars)"
"1"," [1]"
"1"," ""stage_diag""         "
"1"," ""liver_damage""       "
"1"," ""im""                 "
"1"," ""sm""                 "
"1","
"
"1"," [5]"
"1"," ""t""                  "
"1"," ""macroVI""            "
"1"," ""ALBIscore""          "
"1"," ""ast_log1p""          "
"1","
"
"1"," [9]"
"1"," ""tum_count_pre_log1p"""
"1"," ""alt_log1p""          "
"1"," ""max_diam_cm_log1p""  "
"1"," ""afp_l3_log1p""       "
"1","
"
"1","[13]"
"1"," ""tum_diam_pre_log1p"" "
"1","
"
