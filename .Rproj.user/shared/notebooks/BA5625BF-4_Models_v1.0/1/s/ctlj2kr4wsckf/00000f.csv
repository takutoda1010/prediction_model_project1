"0","## ==== PATCH: save risk for ROC (M1_StepAIC_forward) ========================="
"0","# Test 用のリスクスコアを保存（再計算しておく）"
"0","risk_test <- as.numeric(predict(fit_step, newdata = tst, type = ""lp""))"
"0","stopifnot(length(risk_test) == nrow(tst))"
"0",""
"0","if (!exists(""model_results"")) model_results <- list()"
"0","if (is.null(model_results[[model_name_m1]])) model_results[[model_name_m1]] <- list()"
"0",""
"0","model_results[[model_name_m1]]$model_name <- model_name_m1"
"0","model_results[[model_name_m1]]$risk       <- risk_test      # ★ これが無くてスキップされていた"
"0","model_results[[model_name_m1]]$c_index    <- c_index"
"0","model_results[[model_name_m1]]$c_se       <- c_se"
"0","model_results[[model_name_m1]]$c_ci       <- c_ci"
"0",""
"0","# AUC表が計算できていれば統一キーで保存"
"0","if (exists(""auc_df"") && is.data.frame(auc_df)) {"
"0","  model_results[[model_name_m1]]$auc_df <- auc_df"
"0","}"
"0","## ==== PATCH: save risk for ROC (M1_StepAIC_forward) ========================="
"0","# Test 用のリスクスコアを保存（再計算しておく）"
"0","risk_test <- as.numeric(predict(fit_step, newdata = tst, type = ""lp""))"
"0","stopifnot(length(risk_test) == nrow(tst))"
"0",""
"0","if (!exists(""model_results"")) model_results <- list()"
"0","if (is.null(model_results[[model_name_m1]])) model_results[[model_name_m1]] <- list()"
"0",""
"0","model_results[[model_name_m1]]$model_name <- model_name_m1"
"0","model_results[[model_name_m1]]$risk       <- risk_test      # ★ これが無くてスキップされていた"
"0","model_results[[model_name_m1]]$c_index    <- c_index"
"0","model_results[[model_name_m1]]$c_se       <- c_se"
"0","model_results[[model_name_m1]]$c_ci       <- c_ci"
"0",""
"0","# AUC表が計算できていれば統一キーで保存"
"0","if (exists(""auc_df"") && is.data.frame(auc_df)) {"
"0","  model_results[[model_name_m1]]$auc_df <- auc_df"
"0","}"
"0",""
