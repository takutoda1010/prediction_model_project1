"0","## ==== CHUNK3f-cv: サブセット毎に5-fold CVで平均C-index ======================"
"0","K <- 5"
"0","fold_id <- make_folds(trv, K = K)"
"0",""
"0","min_vars <- 5L"
"0","subset_sizes <- seq(from = m, to = max(min_vars, 1L), by = -1L)  # m, m-1, ..., min_vars"
"0",""
"0","cv_results <- vector(""list"", length(subset_sizes))"
"0","names(cv_results) <- paste0(""k"", subset_sizes)"
"0",""
"0","for (i in seq_along(subset_sizes)){"
"0","  k <- subset_sizes[i]"
"0","  # このサイズのサブセット"
"0","  dropped <- if ((m - k) > 0) remove_order[1:(m - k)] else character(0)"
"0","  vars_k  <- setdiff(preds_rfe, dropped)"
"0",""
"0","  # K-fold CV"
"0","  c_fold <- rep(NA_real_, K)"
"0","  for (fold in 1:K){"
"0","    trn <- trv[fold_id != fold, , drop = FALSE]"
"0","    val <- trv[fold_id == fold, , drop = FALSE]"
"0",""
"0","    fit_k <- if (length(vars_k)) {"
"0","      safe_cox(as.formula(paste(""Surv(time2y, event2y) ~"", paste(vars_k, collapse = "" + ""))), trn)"
"0","    } else {"
"0","      safe_cox(Surv(time2y, event2y) ~ 1, trn)"
"0","    }"
"0","    c_fold[fold] <- cindex_on(fit_k, val)"
"0","  }"
"0","  cv_results[[i]] <- list("
"0","    nvar = k,"
"0","    vars = vars_k,"
"0","    c_mean = mean(c_fold, na.rm = TRUE),"
"0","    c_se   = stats::sd(c_fold, na.rm = TRUE) / sqrt(sum(is.finite(c_fold)))"
"0","  )"
"0","}"
"2","Warning: Ran out of iterations and did not converge"
"2","Warning: Ran out of iterations and did not converge"
"2","Warning: Ran out of iterations and did not converge"
"2","Warning: Ran out of iterations and did not converge"
"2","Warning: Ran out of iterations and did not converge"
"2","Warning: Ran out of iterations and did not converge"
"2","Warning: Ran out of iterations and did not converge"
"2","Warning: Ran out of iterations and did not converge"
"2","Warning: Ran out of iterations and did not converge"
"2","Warning: Ran out of iterations and did not converge"
"2","Warning: Ran out of iterations and did not converge"
"2","Warning: Ran out of iterations and did not converge"
"2","Warning: Ran out of iterations and did not converge"
"2","Warning: Ran out of iterations and did not converge"
"2","Warning: Loglik converged before variable  15 ; coefficient may be infinite. "
"2","Warning: Loglik converged before variable  15 ; coefficient may be infinite. "
"2","Warning: Loglik converged before variable  15 ; coefficient may be infinite. "
"2","Warning: Ran out of iterations and did not converge"
"2","Warning: Ran out of iterations and did not converge"
"2","Warning: Ran out of iterations and did not converge"
"2","Warning: Loglik converged before variable  9 ; coefficient may be infinite. "
"2","Warning: Loglik converged before variable  8 ; coefficient may be infinite. "
"0","cv_tab <- do.call(rbind, lapply(cv_results, as.data.frame))"
"0","row.names(cv_tab) <- NULL"
"0","cv_tab <- cv_tab[order(-cv_tab$nvar), ]  # 大きい→小さい順に表示"
"0","print(cv_tab[, c(""nvar"",""c_mean"",""c_se"")], row.names = FALSE)"
