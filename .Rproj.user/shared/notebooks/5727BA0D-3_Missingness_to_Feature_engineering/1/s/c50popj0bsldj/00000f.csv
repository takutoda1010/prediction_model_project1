"0","# ---- recur_2y（rfs_monthsのみ使用）----"
"0","ds04 <- ds04 |>"
"0","  dplyr::mutate("
"0","    # recur_tf を頑健に論理化（factor/chr/TRUE/FALSE の混在でも対応）"
"0","    .recur_event = dplyr::case_when("
"0","      as.character(recur_tf) %in% c(""TRUE"",""True"",""1"",""Yes"",""有"")  ~ TRUE,"
"0","      as.character(recur_tf) %in% c(""FALSE"",""False"",""0"",""No"",""無"") ~ FALSE,"
"0","      TRUE ~ NA"
"0","    ),"
"0","    # 2年以内再発"
"0","    recur_2y = dplyr::case_when("
"0","      .recur_event & rfs_months <= 24 ~ TRUE,"
"0","      .recur_event & rfs_months >  24 ~ FALSE,"
"0","      !.recur_event                   ~ FALSE,   # 無再発は2年内再発なし"
"0","      TRUE                            ~ NA       # まれに recur_tf 解釈不能時"
"0","    )"
"0","  ) |>"
"0","  dplyr::select(-.recur_event)"
"0",""
"0","# 確認（任意）"
"0","table(ds04$recur_tf, ds04$recur_2y, useNA = ""ifany"")"
"1","       
"
"1","       "
"1"," FALSE"
"1"," TRUE"
"1","
  FALSE"
"1","   432"
"1","    0"
"1","
  TRUE "
"1","   138"
"1","  420"
"1","
"
"0","sum(is.na(ds04$recur_2y))"
"1","[1]"
"1"," 0"
"1","
"
