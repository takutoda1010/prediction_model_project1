"0","# 変換前後ヒストグラム（各変数ごとに1図：左=元, 右=変換後）"
"0","if (!requireNamespace(""patchwork"", quietly = TRUE)) install.packages(""patchwork"")"
"0","library(ggplot2); library(patchwork)"
"0",""
"0","# 変換後列（*_log1p / *_asinh / *_reflog1p）と元変数の対応を抽出"
"0","tf_cols <- names(ds07)[grepl(""(_log1p|_asinh|_reflog1p)$"", names(ds07))]"
"0","if (length(tf_cols) == 0L) {"
"0","  message(""可視化対象（変換列）がありません。先に変換を実行してください。"")"
"0","} else {"
"0","  map_tbl <- tibble::tibble(tf = tf_cols) |>"
"0","    dplyr::mutate(var = sub(""(_log1p|_asinh|_reflog1p)$"", """", tf)) |>"
"0","    dplyr::filter(var %in% names(ds07)) |>"
"0","    dplyr::distinct(var, tf)"
"0",""
"0","  fd_bins <- function(x, min_bins = 10, max_bins = 80) {"
"0","    x <- x[is.finite(x)]"
"0","    if (length(x) < 2) return(30)"
"0","    iqr <- stats::IQR(x, na.rm = TRUE)"
"0","    bw  <- 2 * iqr / (length(x)^(1/3))"
"0","    if (!is.finite(bw) || bw <= 0) return(30)"
"0","    rng <- range(x, na.rm = TRUE)"
"0","    bins <- ceiling((rng[2] - rng[1]) / bw)"
"0","    bins <- max(min_bins, min(max_bins, bins))"
"0","    bins"
"0","  }"
"0",""
"0","  for (i in seq_len(nrow(map_tbl))) {"
"0","    v  <- map_tbl$var[i]"
"0","    tf <- map_tbl$tf[i]"
"0",""
"0","    x0 <- ds07[[v]]"
"0","    xt <- ds07[[tf]]"
"0",""
"0","    # 元・変換後のbinsを個別に算出"
"0","    b0 <- fd_bins(x0)"
"0","    bt <- fd_bins(xt)"
"0",""
"0","    p_left <- ggplot(data = data.frame(x = x0), aes(x = x)) +"
"0","      geom_histogram(bins = b0, na.rm = TRUE) +"
"0","      labs(title = paste0(v, "" (original)""), x = v, y = ""count"") +"
"0","      theme_minimal(base_size = 12)"
"0",""
"0","    p_right <- ggplot(data = data.frame(x = xt), aes(x = x)) +"
"0","      geom_histogram(bins = bt, na.rm = TRUE) +"
"0","      labs(title = paste0(tf, "" (transformed)""), x = tf, y = ""count"") +"
"0","      theme_minimal(base_size = 12)"
"0",""
"0","    p <- p_left + p_right + plot_layout(ncol = 2) +"
"0","      plot_annotation(title = paste0(""Histogram: "", v, "" → "", tf))"
"0","    print(p)"
"0","  }"
"0","}"
"0",""
