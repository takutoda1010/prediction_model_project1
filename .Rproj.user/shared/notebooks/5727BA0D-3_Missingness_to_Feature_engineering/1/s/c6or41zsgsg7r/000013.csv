"0","ds04 <- ds04 |>"
"0","  dplyr::mutate("
"0","    # 2年以内再発（rfs_months と recur_tf を素直に使う）"
"0","    .rec2y = (recur_tf %in% TRUE) & (!is.na(rfs_months)) & (rfs_months <= 24),"
"0",""
"0","    # 2年以内死亡（os_months と vital を素直に使う）"
"0","    .is_dead = (vital_status %in% ""死"") | isFALSE(vital10),"
"0","    .death2y = .is_dead & (!is.na(os_months)) & (os_months <= 24),"
"0",""
"0","    # eventfree_2y: 2年以内に再発 or 死亡があれば FALSE"
"0","    # 両方の情報が揃っていて2年を超えて無イベントなら TRUE"
"0","    # 情報不足は NA"
"0","    eventfree_2y = dplyr::case_when("
"0","      .rec2y | .death2y ~ FALSE,"
"0","      (!is.na(rfs_months) & rfs_months > 24) &"
"0","      (!is.na(os_months)  & os_months  > 24) ~ TRUE,"
"0","      TRUE ~ NA"
"0","    )"
"0","  ) |>"
"0","  dplyr::select(-.rec2y, -.death2y, -.is_dead)"
"0",""
