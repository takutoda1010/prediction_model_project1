"0","# ---- CHUNK: audit ds02 (light normalization & overview) ----"
"0","# 1) 前処理：前後空白と全角空白の整理（文字列列のみ）"
"0","ds02 <- ds02 |>"
"0","  dplyr::mutate(dplyr::across("
"0","    .cols = where(is.character),"
"0","    .fns  = ~ stringr::str_squish(stringr::str_replace_all(., ""\u3000"", "" ""))"
"0","  ))"
"0",""
"0","# 2) 論理値にできそうな列（Yes/No, 有/無, TRUE/FALSE, +/- など）を自動検出→to_tfで変換"
"0","tf_tokens <- c(""TRUE"",""FALSE"",""T"",""F"",""有"",""無"",""Yes"",""No"",""yes"",""no"",""1"",""0"",""+"",""-"",""＋"",""－"")"
"0","is_tf_like <- function(x) {"
"0","  vals <- unique(na.omit(trimws(as.character(x))))"
"0","  length(vals) > 0 && all(vals %in% tf_tokens)"
"0","}"
"0","tf_cols <- names(ds02)[vapply(ds02, is_tf_like, logical(1))]"
"0","if (length(tf_cols)) {"
"0","  ds02 <- ds02 |> dplyr::mutate(dplyr::across(dplyr::all_of(tf_cols), to_tf))"
"0","  message(""論理型に変換した列: "", paste(tf_cols, collapse = "", ""))"
"0","}"
"2","論理型に変換した列: n_pre, m_pre, vital10, recur_tf, eventfree10, hcv, ptpe, thoraco_lap, rehepatectomy, n, m, comp_resp
"
"0","# 3) ゼロ分散（全員同じ値）の列を検出（必要なら除外の判断材料）"
"0","zero_var_cols <- names(ds02)[vapply(ds02, function(x) dplyr::n_distinct(x, na.rm = TRUE) <= 1, logical(1))]"
"0","if (length(zero_var_cols)) message(""ゼロ分散の列: "", paste(zero_var_cols, collapse = "", ""))"
"2","ゼロ分散の列: pre_liver_vol, pre_tumor_vol, pre_remnant_vol, pre_func_rate, w2_tumor_vol, w2_func_rate
"
"0","# 4) DataExplorerによる概観と欠損"
"0","DataExplorer::plot_intro(ds02,   title = ""Overview: ds02"")"
