"0","#' ログシステムの初期化（修正版）"
"0","#' @param log_file ログファイルのパス"
"0","#' @param log_level ログレベル（DEBUG, INFO, WARN, ERROR）"
"0","setup_logging <- function(log_file = NULL, log_level = ""INFO"") {"
"0","  "
"0","  if (!requireNamespace(""logger"", quietly = TRUE)) {"
"0","    message(""Logger package not available. Skipping logging setup."")"
"0","    return(invisible(NULL))"
"0","  }"
"0","  "
"0","  # ログファイルパスの設定"
"0","  if (is.null(log_file)) {"
"0","    paths <- setup_project_paths()"
"0","    log_dir <- file.path(paths$output, ""logs"")"
"0","    if (!dir.exists(log_dir)) {"
"0","      dir.create(log_dir, recursive = TRUE, showWarnings = FALSE)"
"0","    }"
"0","    "
"0","    # 日付付きログファイル名"
"0","    log_file <- file.path("
"0","      log_dir, "
"0","      sprintf(""hcc_analysis_%s.log"", format(Sys.Date(), ""%Y%m%d""))"
"0","    )"
"0","  }"
"0","  "
"0","  # loggerの設定（修正版）"
"0","  tryCatch({"
"0","    # 新しいバージョンの書き方"
"0","    logger::log_threshold(log_level)"
"0","    logger::log_appender(logger::appender_tee(log_file))"
"0","  }, error = function(e) {"
"0","    # エラーが出たら古いバージョンの書き方を試す"
"0","    tryCatch({"
"0","      log_levels <- c(DEBUG = 400, INFO = 600, WARN = 700, ERROR = 800)"
"0","      logger::log_threshold(log_levels[log_level])"
"0","      logger::log_appender(logger::appender_tee(log_file))"
"0","    }, error = function(e2) {"
"0","      # それでもダメなら警告を出してログをスキップ"
"0","      message(""Warning: Could not configure logger. Continuing without logging."")"
"0","      return(invisible(NULL))"
"0","    })"
"0","  })"
"0","  "
"0","  # 開始メッセージ（エラーが出ないようにtryCatchで囲む）"
"0","  tryCatch({"
"0","    logger::log_info(""========================================"")"
"0","    logger::log_info(""HCC Prediction Model Analysis Started"")"
"0","    logger::log_info(""Time: {Sys.time()}"")"
"0","    logger::log_info(""R Version: {R.version.string}"")"
"0","    logger::log_info(""Platform: {Sys.info()['sysname']} {Sys.info()['release']}"")"
"0","    logger::log_info(""========================================"")"
"0","  }, error = function(e) {"
"0","    # ログが失敗してもメッセージは表示"
"0","    message(""========================================"")"
"0","    message(""HCC Prediction Model Analysis Started"")"
"0","    message(paste(""Time:"", Sys.time()))"
"0","    message(paste(""R Version:"", R.version.string))"
"0","    message(""========================================"")"
"0","  })"
"0","  "
"0","  invisible(NULL)"
"0","}"
