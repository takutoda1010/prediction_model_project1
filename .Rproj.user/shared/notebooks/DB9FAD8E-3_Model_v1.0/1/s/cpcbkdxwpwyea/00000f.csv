"0","## ==== CHUNK 3: Baselines (complete-case + tiny ridge to avoid separation) ===="
"0",""
"0","# 1) 完全ケース抽出（ERASL-pre/post 用）"
"0","vars_pre  <- c(""sex_male"",""albi23"",""ln_afp"",""ln_diam"",""tum_count"",""time"",""event"")"
"0","vars_post <- c(vars_pre, ""mvi_01"")"
"0",""
"0","ds08_pre_train <- ds04_train %>% tidyr::drop_na(all_of(vars_pre))"
"0","ds09_pre_test  <- ds06_test  %>% tidyr::drop_na(all_of(vars_pre))"
"0",""
"0","ds10_post_train <- ds04_train %>% tidyr::drop_na(all_of(vars_post))"
"0","ds11_post_test  <- ds06_test  %>% tidyr::drop_na(all_of(vars_post))"
"0",""
"0","# 2) ERASL-pre（微小ridgeで発散回避）"
"0","fit_erasl_pre <- coxph("
"0","  Surv(time, event) ~ ridge(sex_male, albi23, ln_afp, ln_diam, tum_count, theta = 1e-6),"
"0","  data = ds08_pre_train, ties = ""efron"""
"0",")"
"0","b_erasl_pre <- broom::tidy(fit_erasl_pre, exponentiate = TRUE, conf.int = TRUE)"
"0",""
"0","lp_pre_test <- predict(fit_erasl_pre, newdata = ds09_pre_test, type = ""lp"")"
"0","c_pre_test  <- c_index(ds09_pre_test$time, ds09_pre_test$event, lp_pre_test)"
"0",""
"0","# 3) ERASL-post（同様に ridge）"
"0","fit_erasl_post <- coxph("
"0","  Surv(time, event) ~ ridge(sex_male, albi23, ln_afp, ln_diam, tum_count, mvi_01, theta = 1e-6),"
"0","  data = ds10_post_train, ties = ""efron"""
"0",")"
"0","b_erasl_post <- broom::tidy(fit_erasl_post, exponentiate = TRUE, conf.int = TRUE)"
"0",""
"0","lp_post_test <- predict(fit_erasl_post, newdata = ds11_post_test, type = ""lp"")"
"0","c_post_test  <- c_index(ds11_post_test$time, ds11_post_test$event, lp_post_test)"
"0",""
"0","# 4) TNM（こちらは従来どおり）"
"0","fit_tnm <- coxph(Surv(time, event) ~ T_cat + N_cat + M_cat,"
"0","                 data = ds04_train %>% tidyr::drop_na(T_cat, N_cat, M_cat, time, event),"
"0","                 ties = ""efron"")"
"0","b_tnm <- broom::tidy(fit_tnm, exponentiate = TRUE, conf.int = TRUE)"
"0",""
"0","lp_tnm_test <- predict(fit_tnm, newdata = ds06_test %>% tidyr::drop_na(T_cat, N_cat, M_cat, time, event), type = ""lp"")"
"0","c_tnm_test  <- c_index((ds06_test %>% tidyr::drop_na(T_cat, N_cat, M_cat, time, event))$time,"
"0","                       (ds06_test %>% tidyr::drop_na(T_cat, N_cat, M_cat, time, event))$event,"
"0","                       lp_tnm_test)"
"0",""
"0","list("
"0","  C_ERASL_pre_test  = c_pre_test,"
"0","  C_ERASL_post_test = c_post_test,"
"0","  C_TNM_test        = c_tnm_test"
"0",")"
"1","$C_ERASL_pre_test
"
"1","[1]"
"1"," 0.4777778"
"1","
"
"1","
"
"1","$C_ERASL_post_test
"
"1","[1]"
"1"," 0.4925926"
"1","
"
"1","
"
"1","$C_TNM_test
"
"1","[1]"
"1"," 0.580791"
"1","
"
"1","
"
