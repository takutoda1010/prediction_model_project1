"0","## ==== CHUNK I: Published ERASL score (template) ===="
"0","# 下の named numeric を論文の係数で置き換えてください"
"0","# 例：erasl_coefs_pre <- c(`(Intercept)`=0.0, sex_male=..., albi23=..., ln_afp=..., ln_diam=..., tum_count=...)"
"0","#     erasl_coefs_post <- c(`(Intercept)`=0.0, sex_male=..., albi23=..., ln_afp=..., ln_diam=..., tum_count=..., mvi_01=...)"
"0",""
"0","score_linear <- function(df, coefs, vars){"
"0","  X <- model.matrix(~ 1 + . , data = df[, vars, drop=FALSE])"
"0","  # 列名を係数名に合わせる（不足列は0、余剰列は落とす）"
"0","  miss <- setdiff(names(coefs), colnames(X)); if(length(miss)) X <- cbind(X, matrix(0, nrow=nrow(X), ncol=length(miss), dimnames=list(NULL, miss)))"
"0","  extra <- setdiff(colnames(X), names(coefs)); if(length(extra)) X <- X[, setdiff(colnames(X), extra), drop=FALSE]"
"0","  X <- X[, names(coefs), drop=FALSE]"
"0","  as.numeric(X %*% coefs)"
"0","}"
"0",""
"0","eval_published <- function(test_df, coefs, vars){"
"0","  dat <- test_df %>% tidyr::drop_na(all_of(c(vars,""time"",""event"")))"
"0","  if(nrow(dat) == 0) return(NA_real_)"
"0","  lp <- score_linear(dat, coefs, vars)"
"0","  c_index(dat$time, as.integer(dat$event!=0), lp)"
"0","}"
"0",""
"0","# 使い方（係数を入れた後に実行）"
"0","# c_pub_pre  <- eval_published(test_common, erasl_coefs_pre,  c(""sex_male"",""albi23"",""ln_afp"",""ln_diam"",""tum_count""))"
"0","# c_pub_post <- eval_published(test_common, erasl_coefs_post, c(""sex_male"",""albi23"",""ln_afp"",""ln_diam"",""tum_count"",""mvi_01""))"
"0",""
