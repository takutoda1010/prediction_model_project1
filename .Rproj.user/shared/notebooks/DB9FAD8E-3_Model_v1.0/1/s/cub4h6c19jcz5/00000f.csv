"0","## ==== CHUNK D: time-dependent AUC(t) & iAUC(1-5y) ===="
"0","# timeROC は ""months"" 前提で 12/36/60 を指定"
"0","tau_vec <- c(12, 36, 60)"
"0","tau_grid <- 12:60  # iAUC を月単位で近似平均"
"0",""
"0","auc_time <- function(lp, times){"
"0","  tr <- timeROC(T = y_time, delta = y_event, marker = lp,"
"0","                cause = 1, times = times, iid = FALSE)"
"0","  tr$AUC"
"0","}"
"0","iauc <- function(lp, grid){"
"0","  tr <- timeROC(T = y_time, delta = y_event, marker = lp,"
"0","                cause = 1, times = grid, iid = FALSE)"
"0","  # 区間[12,60] の正規化面積"
"0","  trapz(grid, tr$AUC) / (max(grid) - min(grid))"
"0","}"
"0",""
"0","A_pre  <- auc_time(lp_pre,  tau_vec)"
"0","A_post <- auc_time(lp_post, tau_vec)"
"0","A_tnm  <- auc_time(lp_tnm,  tau_vec)"
"0","A_las  <- auc_time(lp_lasso,tau_vec)"
"0",""
"0","i_pre  <- iauc(lp_pre,  tau_grid)"
"0","i_post <- iauc(lp_post, tau_grid)"
"0","i_tnm  <- iauc(lp_tnm,  tau_grid)"
"0","i_las  <- iauc(lp_lasso,tau_grid)"
"0",""
"0","dplyr::bind_rows("
"0","  tibble::tibble(model=""ERASL_pre"",  AUC_1y=A_pre[1],  AUC_3y=A_pre[2],  AUC_5y=A_pre[3],  iAUC_1to5=i_pre),"
"0","  tibble::tibble(model=""ERASL_post"", AUC_1y=A_post[1], AUC_3y=A_post[2], AUC_5y=A_post[3], iAUC_1to5=i_post),"
"0","  tibble::tibble(model=""TNM"",        AUC_1y=A_tnm[1],  AUC_3y=A_tnm[2],  AUC_5y=A_tnm[3],  iAUC_1to5=i_tnm),"
"0","  tibble::tibble(model=""LASSO"",      AUC_1y=A_las[1],  AUC_3y=A_las[2],  AUC_5y=A_las[3],  iAUC_1to5=i_las)"
"0",")"
