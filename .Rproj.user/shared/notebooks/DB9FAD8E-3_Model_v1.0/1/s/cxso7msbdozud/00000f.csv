"0","## ==== CHUNK A: Packages & Helpers ===="
"0","req_pkgs <- c(""tidyverse"",""survival"",""timeROC"",""splines"")"
"0","to_install <- setdiff(req_pkgs, rownames(installed.packages()))"
"0","if(length(to_install)) install.packages(to_install, Ncpus = 2)"
"0","invisible(lapply(req_pkgs, library, character.only = TRUE))"
"0",""
"0","# c-index（向きは正）"
"0","c_index <- function(time, event, lp){"
"0","  survival::concordance(Surv(time, event) ~ lp, reverse = TRUE)$concordance"
"0","}"
"0",""
"0","# 台形公式"
"0","trapz <- function(x, y){"
"0","  idx <- order(x); x <- x[idx]; y <- y[idx]"
"0","  sum((x[-1]-x[-length(x)]) * (y[-1]+y[-length(y)]) / 2)"
"0","}"
"0",""
