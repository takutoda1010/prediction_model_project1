"0","## ==== CHUNK F: Harmonize factor levels (T/N/M/HBV) ===="
"0","harmonize_block <- function(d){"
"0","  d %>%"
"0","    mutate("
"0","      # TNM レベルを固定（例：0〜4のみ採用、なければ欠損）"
"0","      T_cat = factor(as.character(T_cat), levels = c(""0"",""1"",""2"",""3"",""4"")),"
"0","      N_cat = factor(as.character(N_cat), levels = c(""0"",""1"",""2"",""3"")),"
"0","      M_cat = factor(as.character(M_cat), levels = c(""0"",""1"")),"
"0",""
"0","      # HBV の表記統一（-, +, ±）"
"0","      hbv = dplyr::case_when("
"0","        .data[[""hbv""]] %in% c(""-"", ""0"", ""negative"",""陰性"") ~ ""-"","
"0","        .data[[""hbv""]] %in% c(""+"", ""1"", ""positive"",""陽性"") ~ ""+"","
"0","        .data[[""hbv""]] %in% c(""±"",""+/-"",""+/−"") ~ ""±"","
"0","        TRUE ~ as.character(.data[[""hbv""]])"
"0","      ),"
"0","      hbv = factor(hbv, levels = c(""-"",""+"",""±""))"
"0","    )"
"0","}"
"0","ds04_train <- harmonize_block(ds04_train)"
"0","ds05_val   <- harmonize_block(ds05_val)"
"0","ds06_test  <- harmonize_block(ds06_test)"
"0",""
