"0","# ========================================================================"
"0","# 追加分析：ROCカーブ、DCA、キャリブレーション"
"0","# ========================================================================"
"0",""
"0","message(""\n========================================"")"
"2","
========================================
"
"0","message(""ADDITIONAL ANALYSIS AND VISUALIZATIONS"")"
"2","ADDITIONAL ANALYSIS AND VISUALIZATIONS
"
"0","message(""========================================\n"")"
"2","========================================

"
"0","# カラーブラインド対応の色設定"
"0","cb_palette <- c(""#E69F00"", ""#56B4E9"", ""#009E73"", ""#F0E442"", "
"0","                ""#0072B2"", ""#D55E00"", ""#CC79A7"", ""#999999"")"
"0",""
"0","# ========================================================================"
"0","# 1. ベストモデルとTNMモデルの準備"
"0","# ========================================================================"
"0",""
"0","message(""1. Preparing models for comparison"")"
"2","1. Preparing models for comparison
"
"0","message(""----------------------------------------"")"
"2","----------------------------------------
"
"0","# ベストモデルの特定"
"0","best_idx <- which.max(evaluation_results$summary$c_index_test)"
"0","best_model_name <- evaluation_results$summary$model[best_idx]"
"0","best_model <- models[[best_model_name]]"
"0",""
"0","message(sprintf(""Best model: %s (C-index = %.3f)"", "
"0","               best_model_name, "
"0","               evaluation_results$summary$c_index_test[best_idx]))"
"2","Best model: m1_stepaic_forward (C-index = 0.776)
"
"0","# TNMモデルの構築（T, N, M ステージのみ使用）"
"0","message(""\nBuilding TNM reference model..."")"
"2","
Building TNM reference model...
"
"0","tnm_data <- split_data_fixed$train"
"0","tnm_formula <- as.formula(""surv_obj ~ t + n + m"")"
"0",""
"0","tnm_model <- tryCatch({"
"0","  coxph(tnm_formula, data = tnm_data)"
"0","}, error = function(e) {"
"0","  message(""  Note: Standard TNM variables not found, using stage_diag as proxy"")"
"0","  # stage_diagが利用可能な場合は代替として使用"
"0","  if (""stage_diag"" %in% names(tnm_data)) {"
"0","    coxph(surv_obj ~ stage_diag, data = tnm_data)"
"0","  } else {"
"0","    NULL"
"0","  }"
"0","})"
"0",""
"0","if (!is.null(tnm_model)) {"
"0","  # TNMモデルの評価"
"0","  tnm_c_index <- concordance(tnm_model)$concordance"
"0","  message(sprintf(""TNM model C-index (train): %.3f"", tnm_c_index))"
"0","}"
"2","TNM model C-index (train): 0.673
"
